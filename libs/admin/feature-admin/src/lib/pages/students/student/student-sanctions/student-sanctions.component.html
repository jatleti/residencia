<ng-container *ngIf="student">
    <p-table
        #dt1
        [value]="student.Sanctions || []"
        styleClass="p-datatable-sm"
        [paginator]="false"
        [rows]="50"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Viendo {first} a {last} de {totalRecords} items"
        [rowsPerPageOptions]="[20, 50]"
        [globalFilterFields]="['name']"
    >
        <ng-template pTemplate="header">
            <tr>
                <th>Fecha</th>
                <th>Descripción</th>
                <th>Por</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
            <tr (click)="editSanction(item)" class="cursor-pointer">
                <td>{{ item.date | date: 'dd/MM/yyyy HH:mm' }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.User?.name }} {{ item.User?.surname }}</td>
            </tr>
        </ng-template>
    </p-table>

    <span *ngIf="!student.Sanctions || student.Sanctions.length === 0">Aún no tienes sanciones para mostrar.</span>

    <div class="flex gap-3 mb-3 justify-end">
        <div *ngIf="isPermitted([Permissions.STUDENT.SANCTION.CREATE])" class="flex-0 pt-6">
            <div class="mb-3">
                <button (click)="addSanction()" pButton pRipple type="button">
                    <i class="fa-sharp fa-solid fa-plus me-2"></i> Añadir sanción
                </button>
            </div>
        </div>
    </div>
</ng-container>

<p-dialog header="Sanción" [modal]="true" [(visible)]="showAddSanction" [style]="{ width: '60%' }">
    <div *ngIf="newSanction.User" class="mb-3 font-bold">
        Creado por: {{ newSanction.User.name }} {{ newSanction.User.surname }}
    </div>
    <div class="mb-3">
        <label htmlFor="name">Descripción</label>
        <input
            class="w-full"
            id="name"
            type="text"
            pInputText
            [(ngModel)]="newSanction.name"
            placeholder="Descripción"
            [maxlength]="500"
        />
    </div>
    <div class="mb-3 flex items-center gap-3">
        <label class="flex-0">Fecha </label>
        <div class="flex-1">
            <p-datepicker
                class="w-full"
                id="date"
                [firstDayOfWeek]="1"
                [(ngModel)]="newSanction.date"
                dateFormat="dd/mm/yy"
                [showTime]="true"
                placeholder="Fecha"
            ></p-datepicker>
        </div>
    </div>
    <div class="mb-3">
        <label>Contenido</label>
        <p-editor [(ngModel)]="newSanction.description" [style]="{ height: '300px' }" />
    </div>
    <div class="mb-3">
        <label>Notas</label>
        <p-editor [(ngModel)]="newSanction.notes" [style]="{ height: '300px' }" />
    </div>

    <div class="flex justify-between gap-2 mt-10">
        <button (click)="showAddSanction = false" pButton pRipple class="p-button-outlined" type="button">
            Cancelar
        </button>
        <div class="flex gap-3 justify-end items-center">
            <button
                *ngIf="newSanction.id && isPermitted([Permissions.STUDENT.SANCTION.DELETE])"
                (click)="delSanction(newSanction)"
                pButton
                pRipple
                type="button"
                icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
            ></button>
            <p-button
                *ngIf="isPermitted([Permissions.STUDENT.SANCTION.EDIT, Permissions.STUDENT.SANCTION.CREATE])"
                label="Guardar"
                [disabled]="saving"
                severity="primary"
                (click)="saveSanction()"
            />
        </div>
    </div>
</p-dialog>
