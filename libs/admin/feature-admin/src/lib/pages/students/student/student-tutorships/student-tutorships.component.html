<ng-container *ngIf="student">
    <p-table
        #dt1
        [value]="student.Tutorships || []"
        styleClass="p-datatable-sm"
        [paginator]="false"
        [rows]="50"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Viendo {first} a {last} de {totalRecords} items"
        [rowsPerPageOptions]="[20, 50]"
        [globalFilterFields]="['name']"
    >
        <ng-template pTemplate="header">
            <tr>
                <th>Fecha</th>
                <th>Descripción</th>
                <th>Por</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
            <ng-container>
                <tr (click)="editTutorship(item)" class="cursor-pointer">
                    <td>{{ item.date | date: 'dd/MM/yyyy HH:mm' }}</td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.User?.name }} {{ item.User?.surname }}</td>
                </tr>
            </ng-container>
        </ng-template>
    </p-table>

    <span *ngIf="student.Invoices?.length === 0">Aún no tienes items para mostrar.</span>

    <div class="flex gap-3 mb-3 justify-end">
        <div *ngIf="isPermitted([Permissions.STUDENT.TUTORSHIP.CREATE])" class="flex-0 pt-6">
            <div class="mb-3">
                <button (click)="addTutorship()" pButton pRipple type="button">
                    <i class="fa-sharp fa-solid fa-plus me-2"></i> Añadir tutoría
                </button>
            </div>
        </div>
    </div>
</ng-container>

<p-dialog header="Tutoría" [modal]="true" [(visible)]="showAddTutorship" [style]="{ width: '60%' }">
    <div *ngIf="newTutorship.User" class="mb-3 font-bold">
        Creado por: {{ newTutorship.User.name }} {{ newTutorship.User.surname }}
    </div>
    <div class="mb-3">
        <label htmlFor="name">Descripción</label>
        <input
            class="w-full"
            id="name"
            type="text"
            pInputText
            [(ngModel)]="newTutorship.name"
            placeholder="Descripción"
            [maxlength]="500"
        />
    </div>
    <div class="mb-3 flex items-center gap-3">
        <label class="flex-0">Fecha </label>
        <div class="flex-1">
            <p-datepicker
                class="w-full"
                id="birthdate"
                [(ngModel)]="newTutorship.date"
                dateFormat="dd/mm/yy"
                [showTime]="true"
                placeholder="Fecha"
            ></p-datepicker>
        </div>
    </div>
    <div class="mb-3">
        <label>Contenido</label>
        <p-editor [(ngModel)]="newTutorship.content" [style]="{ height: '300px' }" />
    </div>
    <div class="mb-3">
        <label>Notas</label>
        <p-editor [(ngModel)]="newTutorship.notes" [style]="{ height: '300px' }" />
    </div>

    <div class="flex justify-between gap-2 mt-10">
        <button (click)="showAddTutorship = false" pButton pRipple class="p-button-outlined" type="button">
            Cancelar
        </button>
        <div class="flex gap-3 justify-end items-center">
            <button
                *ngIf="newTutorship.id && isPermitted([Permissions.STUDENT.TUTORSHIP.DELETE])"
                (click)="delTutorship(newTutorship)"
                pButton
                pRipple
                type="button"
                icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
            ></button>
            <p-button
                *ngIf="isPermitted([Permissions.STUDENT.TUTORSHIP.EDIT, Permissions.STUDENT.TUTORSHIP.CREATE])"
                label="Guardar"
                [disabled]="saving"
                severity="primary"
                (click)="saveTutorship()"
            />
        </div>
    </div>
</p-dialog>
